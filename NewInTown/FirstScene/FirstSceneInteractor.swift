//
//  FirstSceneInteractor.swift
//  NewInTown
//
//  Created by Jan T on 09/10/2018.
//  Copyright (c) 2018 teatracks. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

protocol FirstSceneBusinessLogic {
    func validate(answer: String)
    func fetchStoryLine(withId id: String)
}

protocol FirstSceneDataStore {
    var currentScore: Int {get set}
}

class FirstSceneInteractor: FirstSceneBusinessLogic, FirstSceneDataStore {
    
    var presenter: FirstScenePresentationLogic?
    var currentScore: Int = 0
    var currentStoryLineId: String = "B3045_1"
    var currentDialogIndex: Int = 0
    
    let worker = FirstSceneWorker()
    
    func fetchStoryLine(withId id: String) {
        var response = FirstScene.FetchFirstScene.Response()
        currentStoryLineId = id
        response.storyLineId = currentStoryLineId
        response.score = currentScore
        response.nextIndex = currentDialogIndex
        presenter?.updateFirstScene(response: response)
    }
    
    // MARK: Perform operation on FirstScene

    func validate(answer: String) {
        var response = FirstScene.FetchFirstScene.Response()
        guard let dialog = worker.getDialog(forStoryLineId: currentStoryLineId, atIndex: currentDialogIndex) else {
            return
        }
        response.hasCorrectAnswer = (answer == dialog.answer.pinyin) || (answer == dialog.answer.chinese)
        if response.hasCorrectAnswer {
            currentScore = currentScore + dialog.points
            currentDialogIndex = currentDialogIndex + 1
        } else {
            currentScore = currentScore - 5
        }

        response.score = currentScore
        response.nextIndex = currentDialogIndex
        response.storyLineId = currentStoryLineId
        presenter?.updateFirstScene(response: response)
    }

}
